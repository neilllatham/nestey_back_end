generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/////////////////////////////////////////////////////////
// NESTEY V1.0 â€” CORE HRIS
/////////////////////////////////////////////////////////

model employees {
  employee_id           Int                 @id @default(autoincrement())
  employee_number       String?             @db.VarChar
  first_name            String?             @db.VarChar
  middle_initial        String?             @db.VarChar
  last_name             String?             @db.VarChar
  full_name             String?             @db.VarChar
  preferred_name        String?             @db.VarChar
  job_title             String?             @db.VarChar
  email                 String?             @db.VarChar
  hire_date             DateTime?           @db.Timestamp(6)
  department_id         Int?
  role_id               Int?
  manager_id            Int?
  status                String?             @db.VarChar
  base_salary           Decimal?            @db.Decimal(10, 2)
  bonus_eligible        Boolean?
  target_bonus          Decimal?            @db.Decimal(10, 2)
  commission_eligible   Boolean?
  commission_target     Decimal?            @db.Decimal(4, 2)
  compensation_currency String?             @db.VarChar
  date_of_birth         DateTime?           @db.Date
  employment_type       String?             @db.VarChar
  gender                String?             @db.VarChar
  home_address          String?             @db.VarChar
  mobile_number         String?             @db.VarChar
  hours_per_week        Decimal?            @db.Decimal(3, 1)

  // Relationships
  departments           departments?        @relation(fields: [department_id], references: [department_id], onDelete: NoAction, onUpdate: NoAction)
  roles                 roles?              @relation(fields: [role_id], references: [role_id], onDelete: NoAction, onUpdate: NoAction)  
  manager               employees?          @relation("ManagerToEmployee", fields: [manager_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
  direct_reports        employees[]         @relation("ManagerToEmployee")
  
  // Employee data relationships
  employee_benefits     employee_benefits[]
  employee_reviews      employee_reviews[]
  time_off_accruals     time_off_accruals[]
  time_off_requests     time_off_requests[]
  
  // Recruiting relationships
  candidates_referred   candidates[]        @relation("ReferredBy")
  interviews_conducted  interviews[]        @relation("Interviewer")
  job_postings_managed  job_postings[]      @relation("HiringManager")
  
  // Review feedback relationships
  review_feedback_given review_feedback[]   @relation("FeedbackProvider")
}

model departments {
  department_id   Int           @id @default(autoincrement())
  department_name String?       @db.VarChar
  function_id     Int?
  
  // Relationships
  functions       functions?    @relation(fields: [function_id], references: [function_id], onDelete: NoAction, onUpdate: NoAction)
  employees       employees[]
  roles           roles[]
  job_postings    job_postings[]
}

model functions {
  function_id   Int           @id @default(autoincrement())
  function_name String?       @db.VarChar
  
  // Relationships
  departments   departments[]
}

/////////////////////////////////////////////////////////
// TIME OFF MANAGEMENT
/////////////////////////////////////////////////////////

model time_off_accruals {
  accrual_id      Int        @id @default(autoincrement())
  employee_id     Int?
  type            String?    @db.VarChar
  year            Int?
  accrued_days    Decimal?   @db.Decimal(5, 1)
  used_days       Decimal?   @db.Decimal(5, 1)
  remaining_days  Decimal?   @db.Decimal(5, 1)
  last_updated    DateTime?  @default(dbgenerated("CURRENT_DATE")) @db.Date
  
  // Relationships
  employees       employees? @relation(fields: [employee_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
}

model time_off_requests {
  request_id      Int        @id @default(autoincrement())
  employee_id     Int?
  type            String?    @db.VarChar
  start_date      DateTime?  @db.Date
  end_date        DateTime?  @db.Date
  days_requested  Decimal?   @db.Decimal(5, 1)
  status          String?    @db.VarChar
  created_at      DateTime?  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updated_at      DateTime?  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  
  // Relationships
  employees       employees? @relation(fields: [employee_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
}

/////////////////////////////////////////////////////////
// BENEFITS
/////////////////////////////////////////////////////////

model benefit_plan {
  benefit_plan_id       Int                 @id @default(autoincrement())
  plan_name             String?             @db.VarChar
  coverage_level        String?             @db.VarChar
  region                String?             @db.VarChar
  employer_contribution Decimal?            @db.Decimal(3, 2)
  employee_contribution Decimal?            @db.Decimal(3, 2)
  effective_date        DateTime?           @db.Date
  expiry_date           DateTime?           @db.Date
  type                  String?             @db.VarChar
  
  // Relationships
  benefits_catalog      benefits_catalog[]
  employee_benefits     employee_benefits[]
}

model benefits_catalog {
  benefit_catalog_id         Int           @id @default(autoincrement())
  benefit_name               String?       @db.VarChar
  benefit_category           String?       @db.VarChar
  description                String?       @db.VarChar
  employer_contribution      Decimal?      @db.Decimal(3, 2)
  employee_contribution      Decimal?      @db.Decimal(3, 2)
  dependent_coverage_allowed Boolean?
  eligibility_criteria       String?       @db.VarChar
  created_at                 DateTime?     @db.Date
  updated_at                 DateTime?     @db.Date
  benefit_plan_id            Int?
  employee_pays              Decimal?      @db.Decimal(10, 2)
  employer_pays              Decimal?      @db.Decimal(10, 2)
  total_plan_cost            Decimal?      @db.Decimal(10, 2)
  enrollment_start_date      DateTime?     @default(dbgenerated("'2025-11-01'::date")) @db.Date
  enrollment_end_date        DateTime?     @default(dbgenerated("'2025-11-30'::date")) @db.Date
  
  // Relationships
  benefit_plan               benefit_plan? @relation(fields: [benefit_plan_id], references: [benefit_plan_id], onDelete: NoAction, onUpdate: NoAction)
}

model employee_benefits {
  employee_benefit_id Int           @id @default(autoincrement())
  employee_id         Int?
  benefit_plan_id     Int?
  dependants          Int?
  effective_date      DateTime?     @db.Date
  expiry_date         DateTime?     @db.Date
  date_created        DateTime?     @db.Date
  date_updated        DateTime?     @db.Date
  
  // Relationships
  employees           employees?    @relation(fields: [employee_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
  benefit_plan        benefit_plan? @relation(fields: [benefit_plan_id], references: [benefit_plan_id], onDelete: NoAction, onUpdate: NoAction)
}

/////////////////////////////////////////////////////////
// JOB ARCHITECTURE
/////////////////////////////////////////////////////////

model role_levels {
  role_level_code String              @id @db.VarChar
  role_level_name String?             @db.VarChar
  hierarchy_rank  Int?
  description     String?

  // Relationships
  roles                   roles[]
  competency_definitions  competency_definitions[]
}

model job_families {
  job_family_id   Int     @id @default(autoincrement())
  job_family_name String? @db.VarChar
  description     String?

  // Relationships
  roles           roles[]
}

model roles {
  role_id          Int           @id @default(autoincrement())
  role_name        String?       @db.VarChar
  role_level_code  String?       @db.VarChar
  parent_role_id   Int?
  job_family_id    Int?
  department_id    Int?
  description      String?
  date_created     DateTime?     @default(dbgenerated("CURRENT_DATE")) @db.Date
  date_updated     DateTime?     @default(dbgenerated("CURRENT_DATE")) @db.Date

  // Relationships
  role_levels      role_levels?  @relation(fields: [role_level_code], references: [role_level_code], onDelete: NoAction, onUpdate: NoAction)
  parent_role      roles?        @relation("RoleHierarchy", fields: [parent_role_id], references: [role_id], onDelete: NoAction, onUpdate: NoAction)
  child_roles      roles[]       @relation("RoleHierarchy")
  job_families     job_families? @relation(fields: [job_family_id], references: [job_family_id], onDelete: NoAction, onUpdate: NoAction)
  departments      departments?  @relation(fields: [department_id], references: [department_id], onDelete: NoAction, onUpdate: NoAction)
  
  employees        employees[]
  job_offers       job_offers[]
  job_postings     job_postings[]
}

/////////////////////////////////////////////////////////
// PERFORMANCE REVIEW MODULE
/////////////////////////////////////////////////////////

model review_cycles {
  review_cycle_id Int       @id @default(autoincrement())
  name            String?   @db.VarChar
  cycle_type      String?   @db.VarChar
  period_start    DateTime? @db.Date
  period_end      DateTime? @db.Date
  midyear_start   DateTime? @db.Date
  midyear_end     DateTime? @db.Date
  status          String?   @db.VarChar
  is_active       Boolean?  @default(false)

  // Relationships
  employee_reviews employee_reviews[]
}

model employee_reviews {
  review_id                 Int       @id @default(autoincrement())
  employee_id               Int
  review_cycle_id           Int
  review_status             String?   @db.VarChar
  created_at                DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updated_at                DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  submitted_at              DateTime? @db.Timestamp(6)
  finalized_at              DateTime? @db.Timestamp(6)
  employee_overall_comments String?
  manager_overall_comments  String?
  employee_overall_rating   Int?
  manager_overall_rating    Int?

  // Relationships
  employees               employees             @relation(fields: [employee_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
  review_cycles          review_cycles         @relation(fields: [review_cycle_id], references: [review_cycle_id], onDelete: NoAction, onUpdate: NoAction)
  employee_goals         employee_goals[]
  employee_competencies  employee_competencies[]
  review_feedback        review_feedback[]

  @@unique([employee_id, review_cycle_id], name: "unique_employee_cycle")
}

model employee_goals {
  goal_id           Int       @id @default(autoincrement())
  review_id         Int
  strategy_id       Int?
  objective         String
  goal_description  String
  target_date       DateTime? @db.Date
  employee_rating   Int?
  manager_rating    Int?
  created_at        DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updated_at        DateTime? @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  status            String?   @default("active")

  // Relationships
  employee_reviews  employee_reviews @relation(fields: [review_id], references: [review_id], onDelete: Cascade, onUpdate: NoAction)
  strategies        strategies?      @relation(fields: [strategy_id], references: [strategy_id], onDelete: NoAction, onUpdate: NoAction)
}

model employee_competencies {
  employee_competency_id Int      @id @default(autoincrement())
  review_id              Int
  competency_id          Int
  employee_rating        Int?
  manager_rating         Int?
  employee_comments      String?
  manager_comments       String?

  // Relationships
  employee_reviews   employee_reviews   @relation(fields: [review_id], references: [review_id], onDelete: Cascade, onUpdate: NoAction)
  core_competencies  core_competencies  @relation(fields: [competency_id], references: [competency_id], onDelete: Cascade, onUpdate: NoAction)
}

model core_competencies {
  competency_id   Int    @id @default(autoincrement())
  competency_name String? @db.VarChar
  description     String?

  // Relationships
  employee_competencies   employee_competencies[]
  competency_definitions  competency_definitions[]
}

model competency_definitions {
  competency_def_id   Int     @id @default(autoincrement())
  role_level_code     String? @db.VarChar
  competency_id       Int
  expected_behavior   String?

  // Relationships
  role_levels         role_levels?       @relation(fields: [role_level_code], references: [role_level_code], onDelete: NoAction, onUpdate: NoAction)
  core_competencies   core_competencies  @relation(fields: [competency_id], references: [competency_id], onDelete: NoAction, onUpdate: NoAction)
}

model rating_scale {
  rating_value Int     @id
  rating_label String? @db.VarChar
  description  String?
}

model strategies {
  strategy_id   Int     @id @default(autoincrement())
  strategy_name String? @db.VarChar
  description   String?

  // Relationships
  employee_goals employee_goals[]
}

model review_feedback {
  review_feedback_id     Int     @id @default(autoincrement())
  review_id              Int
  feedback_provider_id   Int
  relationship           String? @db.VarChar
  continue_doing         String?
  start_doing            String?
  stop_doing             String?
  summary_comments       String?

  // Relationships
  employee_reviews       employee_reviews @relation(fields: [review_id], references: [review_id], onDelete: NoAction, onUpdate: NoAction)
  feedback_provider      employees        @relation("FeedbackProvider", fields: [feedback_provider_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
}

/////////////////////////////////////////////////////////
// RECRUITING / TALENT ACQUISITION
/////////////////////////////////////////////////////////

model job_postings {
  job_posting_id    Int            @id @default(autoincrement())
  title             String?        @db.VarChar
  department_id     Int?
  role_id           Int?
  hiring_manager_id Int?
  location          String?        @db.VarChar
  employment_type   String?        @db.VarChar
  description       String?
  requirements      String?
  salary_range_min  Decimal?       @db.Decimal(10, 2)
  salary_range_max  Decimal?       @db.Decimal(10, 2)
  currency          String?        @db.VarChar
  status            String?        @db.VarChar
  date_posted       DateTime?      @db.Date
  date_closed       DateTime?      @db.Date
  created_at        DateTime?      @db.Timestamp(6)
  updated_at        DateTime?      @db.Timestamp(6)

  // Relationships
  departments       departments?   @relation(fields: [department_id], references: [department_id], onDelete: NoAction, onUpdate: NoAction)
  roles             roles?         @relation(fields: [role_id], references: [role_id], onDelete: NoAction, onUpdate: NoAction)
  hiring_manager    employees?     @relation("HiringManager", fields: [hiring_manager_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
  applications      applications[]
}

model candidates {
  candidate_id     Int            @id @default(autoincrement())
  first_name       String?        @db.VarChar
  last_name        String?        @db.VarChar
  email            String?        @db.VarChar
  phone            String?        @db.VarChar
  resume_url       String?        @db.VarChar
  linkedin_profile String?        @db.VarChar
  referred_by      Int?
  current_company  String?        @db.VarChar
  notes            String?
  created_at       DateTime?      @db.Timestamp(6)
  updated_at       DateTime?      @db.Timestamp(6)

  // Relationships
  referring_employee employees?    @relation("ReferredBy", fields: [referred_by], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
  applications       applications[]
}

model applications {
  application_id Int           @id @default(autoincrement())
  candidate_id   Int?
  job_posting_id Int?
  source         String?       @db.VarChar
  status         String?       @db.VarChar
  applied_date   DateTime?     @db.Date
  last_updated   DateTime?     @db.Timestamp(6)

  // Relationships
  candidates     candidates?   @relation(fields: [candidate_id], references: [candidate_id], onDelete: NoAction, onUpdate: NoAction)
  job_postings   job_postings? @relation(fields: [job_posting_id], references: [job_posting_id], onDelete: NoAction, onUpdate: NoAction)
  interviews     interviews[]
  job_offers     job_offers[]
}

model interviews {
  interview_id    Int            @id @default(autoincrement())
  application_id  Int?
  interviewer_id  Int?
  interview_date  DateTime?      @db.Timestamp(6)
  interview_type  String?        @db.VarChar
  feedback        String?
  rating          Int?
  decision        String?        @db.VarChar
  created_at      DateTime?      @db.Timestamp(6)
  updated_at      DateTime?      @db.Timestamp(6)

  // Relationships
  applications    applications?  @relation(fields: [application_id], references: [application_id], onDelete: NoAction, onUpdate: NoAction)
  interviewer     employees?     @relation("Interviewer", fields: [interviewer_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
}

model job_offers {
  offer_id        Int            @id @default(autoincrement())
  application_id  Int?
  offered_role_id Int?
  offered_salary  Decimal?       @db.Decimal(10, 2)
  offered_bonus   Decimal?       @db.Decimal(10, 2)
  start_date      DateTime?      @db.Date
  offer_status    String?        @db.VarChar
  sent_date       DateTime?      @db.Date
  accepted_date   DateTime?      @db.Date
  created_at      DateTime?      @db.Timestamp(6)
  updated_at      DateTime?      @db.Timestamp(6)

  // Relationships
  applications    applications?  @relation(fields: [application_id], references: [application_id], onDelete: NoAction, onUpdate: NoAction)
  offered_role    roles?         @relation(fields: [offered_role_id], references: [role_id], onDelete: NoAction, onUpdate: NoAction)
}